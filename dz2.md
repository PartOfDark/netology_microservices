# Домашнее задание: «Микросервисы — подходы» (инфраструктурное предложение)

---

## Задача 1. Обеспечить разработку (VCS + CI/CD)

**Решение:**  
Использовать облачную платформу **GitLab SaaS** для хранения исходного кода, управления задачами и организации CI/CD, с установкой **GitLab Runner** на собственных серверах или в Kubernetes для выполнения сборок.

**Обоснование выбора:**
- Поддержка Git и возможность создания отдельного репозитория для каждого сервиса.
- Автоматический запуск сборок по событиям из Git (push, merge request).
- Возможность ручного запуска сборок с параметрами.
- Гибкая настройка переменных окружения и параметров для каждой сборки.
- Шаблоны для различных конфигураций сборок, что позволяет стандартизировать процессы.
- Безопасное хранение секретных данных в защищённых переменных, интеграция с Vault.
- Возможность создавать несколько конфигураций сборок из одного репозитория.
- Поддержка кастомных шагов и собственных Docker-образов для выполнения задач.
- Развёртывание агентов сборки на собственных мощностях для контроля над окружением.
- Параллельный запуск нескольких сборок и тестов.

Альтернатива: **GitHub + GitHub Actions** с self-hosted runners — аналогичный функционал в экосистеме GitHub.

---

## Задача 2. Логи

**Решение:**  
Организовать сбор и анализ логов с помощью стека **Fluent Bit → Kafka → OpenSearch → OpenSearch Dashboards (Kibana)**.

**Обоснование выбора:**
- Сбор логов из stdout контейнеров и хостов с помощью Fluent Bit без изменений в приложениях.
- Гарантированная доставка логов с использованием Kafka как буфера с дисковым хранением и подтверждениями доставки.
- Централизованное хранение и индексирование логов в OpenSearch, быстрый полнотекстовый поиск и фильтрация.
- Графический интерфейс OpenSearch Dashboards (или Kibana) для удобной работы разработчиков.
- Возможность предоставления сохранённых поисковых запросов по ссылке.
- Масштабируемость и отказоустойчивость за счёт распределённой архитектуры.

Упрощённая альтернатива (без строгой гарантии доставки): **Promtail → Loki → Grafana**.

---

## Задача 3. Мониторинг

**Решение:**  
Использовать стек **Prometheus + Alertmanager + Grafana** с набором экспортёров (Node Exporter, cAdvisor, kube-state-metrics и т.д.) для сбора метрик.

**Обоснование выбора:**
- Сбор метрик со всех хостов с помощью Node Exporter (CPU, RAM, HDD, Network).
- Сбор метрик использования ресурсов для каждого сервиса через cAdvisor и метрики Kubernetes.
- Возможность добавления специфичных метрик сервисов с помощью клиентских библиотек Prometheus.
- Пользовательский интерфейс Grafana для гибких запросов, агрегаций и построения панелей.
- Возможность создания и настройки различных дашбордов под конкретные задачи.
- Система оповещений Alertmanager, интеграция с мессенджерами и почтой.
- Масштабируемость и долговременное хранение с использованием Thanos или VictoriaMetrics.

---
